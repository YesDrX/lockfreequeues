os: linux

dist: bionic

language: c

branches:
  except:
    - gh-pages

cache:
  directories:
    - "$HOME/.nimble"
    - "$HOME/.choosenim"

matrix:
  include:
    - os: linux
      env:
        - CHOOSENIM_CHOOSE_VERSION=1.2.4
    - os: linux
      language: cpp
      env:
        - CHOOSENIM_CHOOSE_VERSION=1.2.4
        - TEST_CPP=1
    - os: linux
      env:
        - CHOOSENIM_CHOOSE_VERSION=stable
    - os: linux
      language: cpp
      env:
        - CHOOSENIM_CHOOSE_VERSION=stable
        - TEST_CPP=1
    - os: linux
      env:
        - CHOOSENIM_CHOOSE_VERSION=devel
    - os: linux
      language: cpp
      env:
        - CHOOSENIM_CHOOSE_VERSION=devel
        - TEST_CPP=1
    - os: osx
      env:
        - CHOOSENIM_CHOOSE_VERSION=stable
    - os: osx
      language: cpp
      env:
        - CHOOSENIM_CHOOSE_VERSION=stable
        - TEST_CPP=1

install:
  - |
      curl https://nim-lang.org/choosenim/init.sh -sSf > init.sh
      sh init.sh -y

before_script:
  - |
      set -ex
      export CHOOSENIM_NO_ANALYTICS=1
      export PATH=$HOME/.nimble/bin:$PATH

script:
  - |
    nim -v;
    [ "x$TEST_CPP" == "x1" ] \
      && nimble testcpp \
      || nimble test;
